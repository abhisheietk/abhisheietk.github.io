<!DOCTYPE html>
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<html lang="en">
<!--<![endif]-->
	<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <meta name="author" content="Abhishek Bajpai">


        <title>devnotes - MyHDL Primer -<span class="caps">FIFO</span> (First In First&nbsp;Out)</title>


        <!-- CSS -->
        <link rel="stylesheet" href="./theme/css/style.css">

        <!-- Custom CSS -->
        	<link rel="stylesheet" href="./theme/css/colors/red.css" id="colors">

        <!-- Code highlight color scheme -->
            <link href="./theme/css/code_blocks/darkly.css" rel="stylesheet">


        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->




        <meta name="tags" contents="python" />
        <meta name="tags" contents="Myhdl" />

	                <meta property="og:locale" content="">
		<meta property="og:site_name" content="devnotes">

	<meta property="og:type" content="article">
	<meta property="article:author" content="">
	<meta property="og:url" content="./myhdl_primer.html">
	<meta property="og:title" content="MyHDL Primer -<span class="caps">FIFO</span> (First In First&nbsp;Out)">
	<meta property="og:description" content="">
	   <meta property="og:image" content="./images/guilherme-toti.jpg">
	<meta property="article:published_time" content="2016-11-14 16:47:21+05:30">
	</head>
	<body>
		<header id="header">
			<!-- Container -->
			<div class="container">
				<!-- Logo / Mobile Menu -->
				<div class="five columns">
					<div id="textlogo">
						<h1><a href="./">devnotes</a></h1>
					</div>
				</div>
						<!-- Navigation
				================================================== -->
				<div class="eleven columns">

					<nav id="navigation" class="menu">
						<ul id="responsive">

							<li><a href="./">Home</a></li>


						</ul>
					</nav>
				</div>
			</div>
			<!-- Container / End -->
		</header>
		<!-- Header / End -->

		<!-- Breadcrumbs Container-->
		<div id="content-wrapper">
			<section id="titlebar">
				<!-- Container -->
				<div class="container">
				<div class="thirteen columns">
					<nav id="breadcrumbs">
						<ul>
							<li>You are here:</li>
							<li><a href="./">Home</a></li>
<li><a href="./category/myhdl.html">Myhdl</a></li>
<li>MyHDL Primer -<span class="caps">FIFO</span> (First In First&nbsp;Out)</li>
						</ul>
					</nav>
				</div>
				</div>
				<!-- Container / End -->
			</section>

			<div class="container">
	<div class="twelve alt columns">
<article class="post" style="margin: 0; border: 0;">

	<div class="post-format">
		<div class="circle"><i class="icon-pencil"></i><span></span></div>
	</div>

	<section class="post-content">

		<header class="meta">
			<h2><a href="./myhdl_primer.html">MyHDL Primer -<span class="caps">FIFO</span> (First In First&nbsp;Out)</a></h2>
			<ul>
				<li>By <a href="./author/abhishek-bajpai.html">Abhishek Bajpai</a></li>
				<li>Mon 14 November 2016</li>
			</ul>
		</header>

		<p>image:&nbsp;assets/images/MyHDL.jpg</p>
<p><a href="http://www.myhdl.org">MyHDL</a> is a python based <span class="caps">HDL</span> language developed by Jan Decaluwe. Here we will talk about how to write code in&nbsp;MyHDL.</p>
<p>For purpose of simplicity we will try to create <span class="caps">FIFO</span> and its test&nbsp;bench.</p>
<h1>What is <span class="caps">FIFO</span>?</h1>
<p><span class="caps">FIFO</span> is an acronym for first in, first out, a method for organizing and manipulating a data buffer, where the oldest (first) entry, or &#8216;head&#8217; of the queue, is processed first. It is analogous to processing a queue with first-come, first-served (<span class="caps">FCFS</span>) behaviour: where the people leave the queue in the order in which they arrive. curtsy <a href="https://en.wikipedia.org/wiki/FIFO_%28computing_and_electronics%29">wikipedia</a></p>
<p>So lets talk about interface signals for a <span class="caps">FIFO</span>&nbsp;module.</p>
<h2>Half full <span class="caps">FIFO</span>&nbsp;model</h2>
<ul>
<li>clk    : input signal for&nbsp;clock</li>
<li>inbusy : input bus is&nbsp;busy</li>
<li>we     : input bus write&nbsp;enable</li>
<li>din    : input bus data&nbsp;input</li>
<li>outbusy: output bus is&nbsp;busy</li>
<li>rd     : output bus read&nbsp;enable</li>
<li>dout   : output bus data&nbsp;output</li>
<li>rdout  : output bus data&nbsp;valid</li>
<li>rst    : input&nbsp;reset</li>
</ul>
<p>These are the obvious signals one should have in the <span class="caps">FIFO</span> module. &#8220;inbusy&#8221; and &#8220;outbusy&#8221; signals are important in order to signal master that the buffer overflow or underflow event has&nbsp;occured.</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">myhdl</span> <span class="kn">import</span> <span class="n">block</span>

<span class="n">DATA</span><span class="o">=</span><span class="mi">8</span>         <span class="c1">#Size of Data bus</span>
<span class="n">WORD</span><span class="o">=</span><span class="mi">8</span>         <span class="c1">#Size of Data bus</span>
<span class="n">ADDR</span><span class="o">=</span><span class="mi">8</span>         <span class="c1">#Size of address bus</span>
<span class="n">LOWER</span><span class="o">=</span><span class="mi">2</span>        <span class="c1">#lower limit for FIFO read</span>
<span class="n">UPPER</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">)</span><span class="o">-</span><span class="mi">8</span> <span class="c1">#upper limit for FIFO write</span>
<span class="n">OFFSET</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">)</span><span class="o">-</span><span class="mi">8</span> <span class="c1">#upper limit for FIFO write</span>

<span class="nd">@block</span>
<span class="k">def</span> <span class="nf">fifo</span><span class="p">(</span><span class="n">clk</span><span class="p">,</span> <span class="n">inbusy</span><span class="p">,</span> <span class="n">we</span><span class="p">,</span> <span class="n">din</span><span class="p">,</span> <span class="n">outbusy</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">dout</span><span class="p">,</span> <span class="n">rdout</span><span class="p">,</span> <span class="n">rst</span><span class="p">,</span>
          <span class="n">DATA</span><span class="o">=</span><span class="n">DATA</span><span class="p">,</span> <span class="n">ADDR</span><span class="o">=</span><span class="n">ADDR</span><span class="p">,</span> <span class="n">LOWER</span><span class="o">=</span><span class="n">LOWER</span><span class="p">,</span> <span class="n">UPPER</span><span class="o">=</span><span class="n">UPPER</span><span class="p">,</span> <span class="n">OFFSET</span><span class="o">=</span><span class="n">OFFSET</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">instances</span><span class="p">()</span>
</pre></div>


<p>Here @block represents module in <span class="caps">HDL</span>. And instances() return all the instences defined in the module. Presently no instances are&nbsp;defined.</p>
<h2>Signals&nbsp;(wire/registers)</h2>
<p>Lets define some memory for fifo. Here &#8220;<span class="caps">DATA</span>&#8221; is the bus width for the mem register array and &#8220;2**<span class="caps">ADDR</span>&#8221; is the count of total such&nbsp;registers.</p>
<div class="highlight"><pre><span></span>    <span class="n">mem</span> <span class="o">=</span> <span class="p">[</span><span class="n">Signal</span><span class="p">(</span><span class="n">modbv</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="n">DATA</span><span class="p">:])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">ADDR</span><span class="p">)]</span>
</pre></div>


<p>Lets define some signals. &#8220;in_addr&#8221; and &#8220;out_addr&#8221; are two pointer signals which points to the present memory address for the corresponding input and output&nbsp;buses.</p>
<div class="highlight"><pre><span></span>    <span class="n">in_addr</span><span class="p">,</span> <span class="n">out_addr</span><span class="p">,</span> <span class="n">diff</span> <span class="o">=</span> <span class="p">[</span><span class="n">Signal</span><span class="p">(</span><span class="n">modbv</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="n">ADDR</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
    <span class="n">noread</span><span class="o">.</span><span class="n">next</span>  <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</pre></div>


<p>Now lets write some instances. &#8220;@always_seq(clk.posedge, reset = rst)&#8221; emplies a sequential instance where event trigers on positive clock edge. Further all registers gets reset to their initial values on reset&nbsp;event.</p>
<h3>Write Logic&nbsp;instances</h3>
<div class="highlight"><pre><span></span>    <span class="nd">@always_seq</span><span class="p">(</span><span class="n">clk</span><span class="o">.</span><span class="n">posedge</span><span class="p">,</span> <span class="n">reset</span> <span class="o">=</span> <span class="n">rst</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">write_port</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">we</span><span class="p">:</span>
            <span class="n">in_addr</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">in_addr</span> <span class="o">+</span> <span class="n">modbv</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="n">ADDR</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">diff</span> <span class="o">&gt;=</span> <span class="n">UPPER</span><span class="p">):</span> <span class="c1"># Logic for buff overflow</span>
            <span class="n">inbusy</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inbusy</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="nd">@always</span><span class="p">(</span><span class="n">inclk</span><span class="o">.</span><span class="n">posedge</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">write_mem_logic</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">we</span><span class="p">:</span>
            <span class="n">mem</span><span class="p">[</span><span class="n">in_addr</span><span class="p">[</span><span class="n">ADDR</span><span class="p">:]]</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">din</span>
</pre></div>


<h3>Read Logic&nbsp;instances</h3>
<div class="highlight"><pre><span></span>    <span class="nd">@always_seq</span><span class="p">(</span><span class="n">clk</span><span class="o">.</span><span class="n">posedge</span><span class="p">,</span> <span class="n">reset</span> <span class="o">=</span> <span class="n">rst</span><span class="p">)</span> <span class="c1">#    @always(outclk.posedge)</span>
    <span class="k">def</span> <span class="nf">read_port</span><span class="p">():</span>
        <span class="n">dout</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">mem</span><span class="p">[</span><span class="n">out_addr</span><span class="p">[</span><span class="n">ADDR</span><span class="p">:]]</span>
        <span class="k">if</span> <span class="n">rd</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">noread</span><span class="p">:</span>
            <span class="n">out_addr</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">out_addr</span> <span class="o">+</span> <span class="n">modbv</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="n">ADDR</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">rdout</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">rd</span>
        <span class="k">else</span><span class="p">:</span>                
            <span class="n">rdout</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>        
</pre></div>


<p>In order to avoid buffer overflow and underflow events we have to take care of the gap between &#8220;in_addr&#8221; and&nbsp;&#8220;out_addr&#8221;</p>
<div class="highlight"><pre><span></span>    <span class="nd">@always_comb</span>
    <span class="k">def</span> <span class="nf">diffLogic</span><span class="p">():</span>
        <span class="n">diff</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">in_addr</span> <span class="o">-</span> <span class="n">out_addr</span>

    <span class="nd">@always_comb</span>
    <span class="k">def</span> <span class="nf">outbusyLogic</span><span class="p">():</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">diff</span> <span class="o">&lt;=</span> <span class="n">LOWER</span><span class="p">):</span> <span class="c1"># Logic for buff underflow</span>
            <span class="n">outbusy</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">noread</span><span class="o">.</span><span class="n">next</span>  <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outbusy</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">noread</span><span class="o">.</span><span class="n">next</span>  <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>


<p>Let us see the complete&nbsp;code </p>
<div class="highlight"><pre><span></span><span class="c1">#fifo.py</span>
<span class="kn">from</span> <span class="nn">myhdl</span> <span class="kn">import</span> <span class="n">block</span>

<span class="n">DATA</span><span class="o">=</span><span class="mi">8</span>         <span class="c1">#Size of Data bus</span>
<span class="n">WORD</span><span class="o">=</span><span class="mi">8</span>         <span class="c1">#Size of Data bus</span>
<span class="n">ADDR</span><span class="o">=</span><span class="mi">8</span>         <span class="c1">#Size of address bus</span>
<span class="n">LOWER</span><span class="o">=</span><span class="mi">2</span>        <span class="c1">#lower limit for FIFO read</span>
<span class="n">UPPER</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">)</span><span class="o">-</span><span class="mi">8</span> <span class="c1">#upper limit for FIFO write</span>
<span class="n">OFFSET</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">)</span><span class="o">-</span><span class="mi">8</span> <span class="c1">#upper limit for FIFO write</span>

<span class="nd">@block</span>
<span class="k">def</span> <span class="nf">cfifo</span><span class="p">(</span><span class="n">clk</span><span class="p">,</span> <span class="n">inbusy</span><span class="p">,</span> <span class="n">we</span><span class="p">,</span> <span class="n">din</span><span class="p">,</span> <span class="n">outbusy</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">dout</span><span class="p">,</span> <span class="n">rdout</span><span class="p">,</span> <span class="n">rst</span><span class="p">,</span>
          <span class="n">DATA</span><span class="o">=</span><span class="n">DATA</span><span class="p">,</span> <span class="n">ADDR</span><span class="o">=</span><span class="n">ADDR</span><span class="p">,</span> <span class="n">LOWER</span><span class="o">=</span><span class="n">LOWER</span><span class="p">,</span> <span class="n">UPPER</span><span class="o">=</span><span class="n">UPPER</span><span class="p">,</span> <span class="n">OFFSET</span><span class="o">=</span><span class="n">OFFSET</span><span class="p">):</span>

    <span class="n">in_addr</span><span class="p">,</span> <span class="n">out_addr</span><span class="p">,</span> <span class="n">diff</span> <span class="o">=</span> <span class="p">[</span><span class="n">Signal</span><span class="p">(</span><span class="n">modbv</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="n">ADDR</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>

    <span class="n">mem</span> <span class="o">=</span> <span class="p">[</span><span class="n">Signal</span><span class="p">(</span><span class="n">modbv</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="n">DATA</span><span class="p">:])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">ADDR</span><span class="p">)]</span>    

    <span class="nd">@always_seq</span><span class="p">(</span><span class="n">clk</span><span class="o">.</span><span class="n">posedge</span><span class="p">,</span> <span class="n">reset</span> <span class="o">=</span> <span class="n">rst</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">write_port</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">we</span><span class="p">:</span>
            <span class="n">in_addr</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">in_addr</span> <span class="o">+</span> <span class="n">modbv</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="n">ADDR</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">diff</span> <span class="o">&gt;=</span> <span class="n">UPPER</span><span class="p">):</span>
            <span class="n">inbusy</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inbusy</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="nd">@always</span><span class="p">(</span><span class="n">inclk</span><span class="o">.</span><span class="n">posedge</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">write_mem_logic</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">we</span><span class="p">:</span>
            <span class="n">mem</span><span class="p">[</span><span class="n">in_addr</span><span class="p">[</span><span class="n">ADDR</span><span class="p">:]]</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">din</span>


    <span class="nd">@always_seq</span><span class="p">(</span><span class="n">clk</span><span class="o">.</span><span class="n">posedge</span><span class="p">,</span> <span class="n">reset</span> <span class="o">=</span> <span class="n">rst</span><span class="p">)</span> <span class="c1">#    @always(outclk.posedge)</span>
    <span class="k">def</span> <span class="nf">read_port</span><span class="p">():</span>
        <span class="n">dout</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">mem</span><span class="p">[</span><span class="n">out_addr</span><span class="p">[</span><span class="n">ADDR</span><span class="p">:]]</span>
        <span class="k">if</span> <span class="n">rd</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">noread</span><span class="p">:</span>
            <span class="n">out_addr</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">out_addr</span> <span class="o">+</span> <span class="n">modbv</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="n">ADDR</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">rdout</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">rd</span>
        <span class="k">else</span><span class="p">:</span>                
            <span class="n">rdout</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="nd">@always_comb</span>
    <span class="k">def</span> <span class="nf">diffLogic</span><span class="p">():</span>
        <span class="n">diff</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">in_addr</span> <span class="o">-</span> <span class="n">out_addr</span>

    <span class="nd">@always_comb</span>
    <span class="k">def</span> <span class="nf">outbusyLogic</span><span class="p">():</span>
        <span class="c1">#level.next = diff</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">diff</span> <span class="o">&lt;=</span> <span class="n">LOWER</span><span class="p">):</span>
            <span class="n">outbusy</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">noread</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outbusy</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">noread</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">instances</span><span class="p">()</span>
</pre></div>


<h3>Test&nbsp;Bench</h3>
<p>In order to write a test bench we will use a puthon&#8217;s unit test framework. In order to use this frame work we will write a testcase&nbsp;class. </p>
<p>At first lets write a skelton class &#8220;TestFifo&#8221; which actually does&nbsp;noting.</p>
<div class="highlight"><pre><span></span><span class="c1">#test_fifo.py</span>
<span class="kn">from</span> <span class="nn">unittest</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">import</span> <span class="nn">unittest</span>

<span class="k">class</span> <span class="nc">TestFifo</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">testFifoBuffer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check that fifo can be write and read &quot;&quot;&quot;</span>     
        <span class="nd">@block</span>
        <span class="k">def</span> <span class="nf">test_fifo</span><span class="p">():</span> 

            <span class="k">return</span> <span class="n">instances</span><span class="p">()</span>


        <span class="n">tb</span> <span class="o">=</span> <span class="n">test_cfifo</span><span class="p">()</span>
        <span class="n">tb</span><span class="o">.</span><span class="n">config_sim</span><span class="p">(</span><span class="n">trace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">tb</span><span class="o">.</span><span class="n">run_sim</span><span class="p">(</span><span class="n">duration</span><span class="o">=</span><span class="mi">1500</span><span class="p">)</span>
        <span class="n">tb</span><span class="o">.</span><span class="n">quit_sim</span><span class="p">()</span>
</pre></div>


<p>On running the test output is as&nbsp;follows.</p>
<div class="highlight"><pre><span></span>abhishek@abhishek:~/2016/MyHDL_tutorial$ python -m test_fifo
&lt;class <span class="s1">&#39;myhdl.StopSimulation&#39;</span>&gt;: No more events
.
----------------------------------------------------------------------
Ran <span class="m">1</span> <span class="nb">test</span> in <span class="m">0</span>.017s

OK
</pre></div>


<p>Now lets populate the test bench. &#8220;createbuff&#8221; creates a test buffer that we will write to the fifo&nbsp;later.</p>
<div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">testBuffer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check that buffer can be write and read &quot;&quot;&quot;</span>
        <span class="n">ADDR</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">DATA</span> <span class="o">=</span> <span class="mi">16</span>
        <span class="n">OFFSET</span> <span class="o">=</span> <span class="mi">8</span>
        <span class="n">LOWER</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">UPPER</span> <span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="n">ADDR</span><span class="o">-</span><span class="mi">4</span>
        <span class="n">WATCHDOG</span> <span class="o">=</span> <span class="mi">3000</span>

        <span class="k">def</span> <span class="nf">createbuff</span><span class="p">(</span><span class="n">DATA</span><span class="p">,</span> <span class="n">ADDR</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">Signal</span><span class="p">(</span><span class="n">intbv</span><span class="p">(</span><span class="n">randrange</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">DATA</span><span class="p">)))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">4</span><span class="p">)]</span>
</pre></div>


<p>Now here again &#8220;@block&#8221; we are defining a test bench module to test fifo. Various signals have been defined. &#8220;fifo_inst&#8221; that is device under test, also defined&nbsp;here.</p>
<div class="highlight"><pre><span></span>            <span class="n">clk</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">rst</span> <span class="o">=</span> <span class="n">ResetSignal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">async</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

            <span class="n">we</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">inbusy</span><span class="p">,</span> <span class="n">outbusy</span><span class="p">,</span> <span class="n">hfull</span><span class="p">,</span> <span class="n">rdout</span> <span class="o">=</span> <span class="p">[</span><span class="n">Signal</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)]</span>
            <span class="n">din</span><span class="p">,</span> <span class="n">dout</span> <span class="o">=</span> <span class="p">[</span><span class="n">Signal</span><span class="p">(</span><span class="n">intbv</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="n">DATA</span><span class="p">:])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>

            <span class="n">fifo_inst</span> <span class="o">=</span> <span class="n">fifo</span><span class="p">(</span><span class="n">clk</span><span class="p">,</span> <span class="n">inbusy</span><span class="p">,</span> <span class="n">we</span><span class="p">,</span> <span class="n">din</span><span class="p">,</span> 
                      <span class="n">outbusy</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">dout</span><span class="p">,</span> <span class="n">rdout</span><span class="p">,</span> <span class="n">rst</span><span class="p">,</span>
                      <span class="n">ADDR</span><span class="o">=</span><span class="n">ADDR</span><span class="p">,</span> <span class="n">DATA</span><span class="o">=</span><span class="n">DATA</span><span class="p">,</span> <span class="n">OFFSET</span><span class="o">=</span><span class="n">OFFSET</span><span class="p">,</span> <span class="n">LOWER</span><span class="o">=</span><span class="n">LOWER</span><span class="p">,</span> <span class="n">UPPER</span><span class="o">=</span><span class="n">UPPER</span><span class="p">)</span>
</pre></div>


<p><span class="dquo">&#8220;</span>fifo_inst.convert&#8221; converts fifo MyHDL model to the&nbsp;verilog.</p>
<div class="highlight"><pre><span></span>            <span class="n">fifo_inst</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">hdl</span><span class="o">=</span><span class="s1">&#39;Verilog&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;fifo_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ADDR</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">DATA</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span>
                          <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">OFFSET</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">LOWER</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">UPPER</span><span class="p">))</span>
</pre></div>


<p>Lets generate &#8220;clk&#8221; and &#8220;rst&#8221; logic&nbsp;signals.</p>
<div class="highlight"><pre><span></span>            <span class="nd">@always</span><span class="p">(</span><span class="n">delay</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span>
            <span class="k">def</span> <span class="nf">clkgen</span><span class="p">():</span>
                <span class="n">clk</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">clk</span>

            <span class="n">rambuff</span> <span class="o">=</span> <span class="n">createbuff</span><span class="p">(</span><span class="n">DATA</span><span class="p">,</span> <span class="n">ADDR</span><span class="p">)</span> 

            <span class="nd">@instance</span>
            <span class="k">def</span> <span class="nf">stimulus</span><span class="p">():</span>
                <span class="k">yield</span> <span class="n">delay</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
                <span class="n">rst</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">yield</span> <span class="n">delay</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
                <span class="n">rst</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">yield</span> <span class="n">delay</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>


<p>Lets logic for writing to and reading from&nbsp;fifo.</p>
<div class="highlight"><pre><span></span>            <span class="nd">@instance</span>
            <span class="k">def</span> <span class="nf">write</span><span class="p">():</span>
                <span class="n">we</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                <span class="k">yield</span> <span class="n">delay</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">rambuff</span><span class="p">:</span>                        
                    <span class="k">yield</span> <span class="n">clk</span><span class="o">.</span><span class="n">posedge</span>
                    <span class="k">while</span> <span class="n">inbusy</span><span class="p">:</span>
                        <span class="n">we</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">yield</span> <span class="n">clk</span><span class="o">.</span><span class="n">posedge</span>

                    <span class="n">we</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="mi">1</span>                    
                    <span class="n">din</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">data</span>                        

                <span class="k">yield</span> <span class="n">clk</span><span class="o">.</span><span class="n">posedge</span>
                <span class="n">we</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="c1">#din.next = 0</span>

            <span class="nd">@instance</span>
            <span class="k">def</span> <span class="nf">read</span><span class="p">():</span>
                <span class="n">watchdog</span> <span class="o">=</span> <span class="mi">30</span>
                <span class="n">watchctr</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">yield</span> <span class="n">delay</span><span class="p">(</span><span class="mi">250</span><span class="p">)</span>
                <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">clk</span><span class="o">.</span><span class="n">posedge</span>
                    <span class="k">if</span> <span class="n">watchctr</span> <span class="o">==</span> <span class="n">watchdog</span><span class="p">:</span>
                        <span class="n">watchctr</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">break</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">outbusy</span><span class="p">:</span>
                        <span class="n">rd</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">rd</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                        <span class="n">watchctr</span> <span class="o">=</span> <span class="n">watchctr</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="c1">#print watchctr</span>

                    <span class="k">if</span> <span class="p">(</span><span class="n">rdout</span><span class="p">):</span>
                        <span class="k">print</span> <span class="nb">hex</span><span class="p">(</span><span class="n">dout</span><span class="p">),</span> <span class="nb">hex</span><span class="p">(</span><span class="n">rambuff</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="c1">#self.assertEqual(dout, rambuff[j])</span>
                        <span class="n">j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>

                <span class="k">yield</span> <span class="n">clk</span><span class="o">.</span><span class="n">posedge</span>
                <span class="n">rd</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</pre></div>


<p>Here is the complete code for test&nbsp;bench.</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">unittest</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">myhdl</span> <span class="kn">import</span> <span class="n">block</span><span class="p">,</span> <span class="n">instances</span><span class="p">,</span> <span class="n">Signal</span><span class="p">,</span> <span class="n">modbv</span><span class="p">,</span> <span class="n">ResetSignal</span><span class="p">,</span> <span class="n">intbv</span><span class="p">,</span> <span class="n">always</span><span class="p">,</span> <span class="n">delay</span><span class="p">,</span> <span class="n">instance</span>
<span class="kn">from</span> <span class="nn">fifo</span> <span class="kn">import</span> <span class="n">fifo</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randrange</span>

<span class="k">class</span> <span class="nc">TestFifo</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">testFifoBuffer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check that fifo can be write and read &quot;&quot;&quot;</span>
        <span class="n">ADDR</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">DATA</span> <span class="o">=</span> <span class="mi">16</span>
        <span class="n">OFFSET</span> <span class="o">=</span> <span class="mi">8</span>
        <span class="n">LOWER</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">UPPER</span> <span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="n">ADDR</span><span class="o">-</span><span class="mi">4</span>
        <span class="n">WATCHDOG</span> <span class="o">=</span> <span class="mi">3000</span>
        <span class="k">def</span> <span class="nf">createbuff</span><span class="p">(</span><span class="n">DATA</span><span class="p">,</span> <span class="n">ADDR</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">Signal</span><span class="p">(</span><span class="n">intbv</span><span class="p">(</span><span class="n">randrange</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">DATA</span><span class="p">)))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">4</span><span class="p">)]</span>

        <span class="nd">@block</span>
        <span class="k">def</span> <span class="nf">tb_fifo</span><span class="p">():</span> 
            <span class="n">clk</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">rst</span> <span class="o">=</span> <span class="n">ResetSignal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">async</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

            <span class="n">we</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">inbusy</span><span class="p">,</span> <span class="n">outbusy</span><span class="p">,</span> <span class="n">hfull</span><span class="p">,</span> <span class="n">rdout</span> <span class="o">=</span> <span class="p">[</span><span class="n">Signal</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)]</span>
            <span class="n">din</span><span class="p">,</span> <span class="n">dout</span> <span class="o">=</span> <span class="p">[</span><span class="n">Signal</span><span class="p">(</span><span class="n">intbv</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="n">DATA</span><span class="p">:])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>

            <span class="n">fifo_inst</span> <span class="o">=</span> <span class="n">fifo</span><span class="p">(</span><span class="n">clk</span><span class="p">,</span> <span class="n">inbusy</span><span class="p">,</span> <span class="n">we</span><span class="p">,</span> <span class="n">din</span><span class="p">,</span> 
                      <span class="n">outbusy</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">dout</span><span class="p">,</span> <span class="n">rdout</span><span class="p">,</span> <span class="n">rst</span><span class="p">,</span>
                      <span class="n">ADDR</span><span class="o">=</span><span class="n">ADDR</span><span class="p">,</span> <span class="n">DATA</span><span class="o">=</span><span class="n">DATA</span><span class="p">,</span> <span class="n">OFFSET</span><span class="o">=</span><span class="n">OFFSET</span><span class="p">,</span> <span class="n">LOWER</span><span class="o">=</span><span class="n">LOWER</span><span class="p">,</span> <span class="n">UPPER</span><span class="o">=</span><span class="n">UPPER</span><span class="p">)</span>

            <span class="n">fifo_inst</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">hdl</span><span class="o">=</span><span class="s1">&#39;Verilog&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;fifo_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ADDR</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">DATA</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span>
                          <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">OFFSET</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">LOWER</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">UPPER</span><span class="p">))</span>

            <span class="nd">@always</span><span class="p">(</span><span class="n">delay</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span>
            <span class="k">def</span> <span class="nf">clkgen</span><span class="p">():</span>
                <span class="n">clk</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">clk</span>

            <span class="n">rambuff</span> <span class="o">=</span> <span class="n">createbuff</span><span class="p">(</span><span class="n">DATA</span><span class="p">,</span> <span class="n">ADDR</span><span class="p">)</span> 

            <span class="nd">@instance</span>
            <span class="k">def</span> <span class="nf">stimulus</span><span class="p">():</span>
                <span class="k">yield</span> <span class="n">delay</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
                <span class="n">rst</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">yield</span> <span class="n">delay</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
                <span class="n">rst</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">yield</span> <span class="n">delay</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

            <span class="nd">@instance</span>
            <span class="k">def</span> <span class="nf">write</span><span class="p">():</span>
                <span class="n">we</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                <span class="k">yield</span> <span class="n">delay</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">rambuff</span><span class="p">:</span>                        
                    <span class="k">yield</span> <span class="n">clk</span><span class="o">.</span><span class="n">posedge</span>
                    <span class="k">while</span> <span class="n">inbusy</span><span class="p">:</span>
                        <span class="n">we</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">yield</span> <span class="n">clk</span><span class="o">.</span><span class="n">posedge</span>

                    <span class="n">we</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="mi">1</span>                    
                    <span class="n">din</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">data</span>                        

                <span class="k">yield</span> <span class="n">clk</span><span class="o">.</span><span class="n">posedge</span>
                <span class="n">we</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="c1">#din.next = 0</span>

            <span class="nd">@instance</span>
            <span class="k">def</span> <span class="nf">read</span><span class="p">():</span>
                <span class="n">watchdog</span> <span class="o">=</span> <span class="mi">30</span>
                <span class="n">watchctr</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">yield</span> <span class="n">delay</span><span class="p">(</span><span class="mi">250</span><span class="p">)</span>
                <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">clk</span><span class="o">.</span><span class="n">posedge</span>
                    <span class="k">if</span> <span class="n">watchctr</span> <span class="o">==</span> <span class="n">watchdog</span><span class="p">:</span>
                        <span class="n">watchctr</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">break</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">outbusy</span><span class="p">:</span>
                        <span class="n">rd</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">rd</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                        <span class="n">watchctr</span> <span class="o">=</span> <span class="n">watchctr</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="c1">#print watchctr</span>

                    <span class="k">if</span> <span class="p">(</span><span class="n">rdout</span><span class="p">):</span>
                        <span class="k">print</span> <span class="nb">hex</span><span class="p">(</span><span class="n">dout</span><span class="p">),</span> <span class="nb">hex</span><span class="p">(</span><span class="n">rambuff</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="c1">#self.assertEqual(dout, rambuff[j])</span>
                        <span class="n">j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>

                <span class="k">yield</span> <span class="n">clk</span><span class="o">.</span><span class="n">posedge</span>
                <span class="n">rd</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>


            <span class="k">return</span> <span class="n">instances</span><span class="p">()</span>


        <span class="n">tb</span> <span class="o">=</span> <span class="n">tb_fifo</span><span class="p">()</span>
        <span class="n">tb</span><span class="o">.</span><span class="n">config_sim</span><span class="p">(</span><span class="n">trace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">tb</span><span class="o">.</span><span class="n">run_sim</span><span class="p">(</span><span class="n">duration</span><span class="o">=</span><span class="mi">1500</span><span class="p">)</span>
        <span class="n">tb</span><span class="o">.</span><span class="n">quit_sim</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>


<p>here is the output while execution of the test&nbsp;bench.</p>
<div class="highlight"><pre><span></span>abhishek@abhishek:~/2016/MyHDL_tutorial$ python2 -m test_fifo
0xd71e 0xd71e
0xdfcb 0xdfcb
0xdb09 0xdb09
0xaa7a 0xaa7a
0x7166 0x7166
0xf851 0xf851
0x2fbf 0x2fbf
0x4cb1 0x4cb1
0x5f3d 0x5f3d
0x32f4 0x32f4
0x67ac 0x67ac
0x4273 0x4273
&lt;class <span class="s1">&#39;myhdl._SuspendSimulation&#39;</span>&gt;: Simulated <span class="m">1500</span> timesteps
.
----------------------------------------------------------------------
Ran <span class="m">1</span> <span class="nb">test</span> in <span class="m">0</span>.064s

OK
</pre></div>


<p>It also generates signal traces that we can see by reading generated *.vcd file in&nbsp;gtkwave.</p>
<p>![TestBench]({{ site.url&nbsp;}}/assets/images/myhdl_fifo.png){:height=&#8221;450px&#8221;}</p>
<p>Finally lets see the converted&nbsp;design.</p>
<div class="highlight"><pre><span></span><span class="c1">// File: fifo_4_16_8_4_12.v</span>
<span class="c1">// Generated by MyHDL 1.0dev</span>
<span class="c1">// Date: Sat Nov 19 08:42:16 2016</span>


<span class="no">`timescale</span> <span class="mh">1</span><span class="n">ns</span><span class="o">/</span><span class="mh">10</span><span class="n">ps</span>

<span class="k">module</span> <span class="n">fifo_4_16_8_4_12</span> <span class="p">(</span>
    <span class="n">clk</span><span class="p">,</span>
    <span class="n">inbusy</span><span class="p">,</span>
    <span class="n">we</span><span class="p">,</span>
    <span class="n">din</span><span class="p">,</span>
    <span class="n">outbusy</span><span class="p">,</span>
    <span class="n">rd</span><span class="p">,</span>
    <span class="n">dout</span><span class="p">,</span>
    <span class="n">rdout</span><span class="p">,</span>
    <span class="n">rst</span>
<span class="p">);</span>


<span class="k">input</span> <span class="n">clk</span><span class="p">;</span>
<span class="k">output</span> <span class="n">inbusy</span><span class="p">;</span>
<span class="kt">reg</span> <span class="n">inbusy</span><span class="p">;</span>
<span class="k">input</span> <span class="n">we</span><span class="p">;</span>
<span class="k">input</span> <span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">din</span><span class="p">;</span>
<span class="k">output</span> <span class="n">outbusy</span><span class="p">;</span>
<span class="kt">reg</span> <span class="n">outbusy</span><span class="p">;</span>
<span class="k">input</span> <span class="n">rd</span><span class="p">;</span>
<span class="k">output</span> <span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">dout</span><span class="p">;</span>
<span class="kt">reg</span> <span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">dout</span><span class="p">;</span>
<span class="k">output</span> <span class="n">rdout</span><span class="p">;</span>
<span class="kt">reg</span> <span class="n">rdout</span><span class="p">;</span>
<span class="k">input</span> <span class="n">rst</span><span class="p">;</span>

<span class="kt">reg</span> <span class="p">[</span><span class="mh">4</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">out_addr</span><span class="p">;</span>
<span class="kt">reg</span> <span class="p">[</span><span class="mh">4</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">in_addr</span><span class="p">;</span>
<span class="kt">reg</span> <span class="n">noread</span><span class="p">;</span>
<span class="kt">wire</span> <span class="p">[</span><span class="mh">4</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">diff</span><span class="p">;</span>
<span class="kt">reg</span> <span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">mem</span> <span class="p">[</span><span class="mh">0</span><span class="o">:</span><span class="mh">16</span><span class="o">-</span><span class="mh">1</span><span class="p">];</span>



<span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span><span class="p">)</span> <span class="k">begin</span><span class="o">:</span> <span class="no">FIFO_4_16_8_4_12_WRITE_PORT</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">rst</span> <span class="o">==</span> <span class="mh">1</span><span class="p">)</span> <span class="k">begin</span>
        <span class="n">inbusy</span> <span class="o">&lt;=</span> <span class="mh">0</span><span class="p">;</span>
        <span class="n">in_addr</span> <span class="o">&lt;=</span> <span class="mh">0</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="k">else</span> <span class="k">begin</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">we</span><span class="p">)</span> <span class="k">begin</span>
            <span class="n">in_addr</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">in_addr</span> <span class="o">+</span> <span class="mh">5&#39;h1</span><span class="p">);</span>
        <span class="k">end</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">diff</span> <span class="o">&gt;=</span> <span class="mh">12</span><span class="p">))</span> <span class="k">begin</span>
            <span class="n">inbusy</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="mh">1</span> <span class="o">!=</span> <span class="mh">0</span><span class="p">);</span>
        <span class="k">end</span>
        <span class="k">else</span> <span class="k">begin</span>
            <span class="n">inbusy</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="mh">0</span> <span class="o">!=</span> <span class="mh">0</span><span class="p">);</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>


<span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span><span class="p">)</span> <span class="k">begin</span><span class="o">:</span> <span class="no">FIFO_4_16_8_4_12_READ_PORT</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">rst</span> <span class="o">==</span> <span class="mh">1</span><span class="p">)</span> <span class="k">begin</span>
        <span class="n">out_addr</span> <span class="o">&lt;=</span> <span class="mh">0</span><span class="p">;</span>
        <span class="n">rdout</span> <span class="o">&lt;=</span> <span class="mh">0</span><span class="p">;</span>
        <span class="n">dout</span> <span class="o">&lt;=</span> <span class="mh">0</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="k">else</span> <span class="k">begin</span>
        <span class="n">dout</span> <span class="o">&lt;=</span> <span class="n">mem</span><span class="p">[</span><span class="n">out_addr</span><span class="p">[</span><span class="mh">4</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]];</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">rd</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="n">noread</span><span class="p">)))</span> <span class="k">begin</span>
            <span class="n">out_addr</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">out_addr</span> <span class="o">+</span> <span class="mh">5&#39;h1</span><span class="p">);</span>
            <span class="n">rdout</span> <span class="o">&lt;=</span> <span class="n">rd</span><span class="p">;</span>
        <span class="k">end</span>
        <span class="k">else</span> <span class="k">begin</span>
            <span class="n">rdout</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="mh">0</span> <span class="o">!=</span> <span class="mh">0</span><span class="p">);</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>


<span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span><span class="p">)</span> <span class="k">begin</span><span class="o">:</span> <span class="no">FIFO_4_16_8_4_12_WRITE_MEM_LOGIC</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">we</span><span class="p">)</span> <span class="k">begin</span>
        <span class="n">mem</span><span class="p">[</span><span class="n">in_addr</span><span class="p">[</span><span class="mh">4</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]]</span> <span class="o">&lt;=</span> <span class="n">din</span><span class="p">;</span>
    <span class="k">end</span>
<span class="k">end</span>



<span class="k">assign</span> <span class="n">diff</span> <span class="o">=</span> <span class="p">(</span><span class="n">in_addr</span> <span class="o">-</span> <span class="n">out_addr</span><span class="p">);</span>


<span class="k">always</span> <span class="p">@(</span><span class="n">diff</span><span class="p">)</span> <span class="k">begin</span><span class="o">:</span> <span class="no">FIFO_4_16_8_4_12_OUTBUSYLOGIC</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">diff</span> <span class="o">&lt;=</span> <span class="mh">4</span><span class="p">))</span> <span class="k">begin</span>
        <span class="n">outbusy</span> <span class="o">=</span> <span class="p">(</span><span class="mh">1</span> <span class="o">!=</span> <span class="mh">0</span><span class="p">);</span>
        <span class="n">noread</span> <span class="o">=</span> <span class="p">(</span><span class="mh">1</span> <span class="o">!=</span> <span class="mh">0</span><span class="p">);</span>
    <span class="k">end</span>
    <span class="k">else</span> <span class="k">begin</span>
        <span class="n">outbusy</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0</span> <span class="o">!=</span> <span class="mh">0</span><span class="p">);</span>
        <span class="n">noread</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0</span> <span class="o">!=</span> <span class="mh">0</span><span class="p">);</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="k">endmodule</span>
</pre></div>
		    <div class="tags">
		        <p>tags: <a href="./tag/python.html">python</a><a href="./tag/myhdl.html">Myhdl</a></p>
		    </div>

<div class="sharing">
</div>
<hr>

	</section>
	<div class="clearfix"></div>

</article>

	</div>

	<!-- Sidebar -->
	<div class="four columns">
		<!-- About  -->
		<div class="widget no-mg-top">
			<h3 class="headline">About</h3><span class="line"></span><div class="clearfix"></div>
			<p>This is the place holder for my technical endivors.</p>
		</div>

		<!-- Categories -->
		<div class="widget">
			<h3 class="headline">Categories</h3><span class="line"></span><div class="clearfix"></div>
			<nav class="categories">
				<ul>
					    <li><a href="./category/misc.html">misc</a></li>
					    <li class="active"><a href="./category/myhdl.html">Myhdl</a></li>
					    <li><a href="./category/notes.html">notes</a></li>
					    <li><a href="./category/web2py.html">web2py</a></li>
				</ul>
			</nav>
		</div>
		
		<!-- Tags -->
		<div class="widget">
			<h3 class="headline">Tags</h3><span class="line"></span><div class="clearfix"></div>
			<nav class="tags">				    <a href="./tag/myhdl.html">Myhdl</a>
				    <a href="./tag/pandas.html">pandas</a>
				    <a href="./tag/python.html">python</a>
				    <a href="./tag/web2py.html">web2py</a>
			</nav>
		</div>
	</div>
			</div>
			<!-- Container / End -->
		</div>
		<!-- Content Wrapper / End -->

		<div id="footer-bottom">
			<!-- Container -->
			<div class="container">
				<div class="eight columns">&copy; Text Here  || Blog powered by <a href="http://getpelican.com">Pelican</a></div>
					<div class="eight columns">
						<ul class="social-icons-footer">
								<li>
									<a href="https://plus.google.com/u/0/+AbhishekBajpaiJi" class="tooltip top" title="Google+">
										<i class="icon-google+"></i>
									</a>
								</li>
								<li>
									<a href="https://twitter.com/abhisheietk" class="tooltip top" title="Twitter">
										<i class="icon-twitter"></i>
									</a>
								</li>
							<li><a href="./None" class="tooltip top" title="RSS"><i class="icon-rss"></i></a></li>
						</ul>
					</div>
			</div>
			<!-- Container / End -->
		</div>
		<!-- Footer Bottom / End -->

	<!-- Javascripts -->
	<script src="./theme/js/jquery.min.js"></script>
	</body>
</html>